// JavaScript Document
(function (c) {
	var tmpcovers = Array();
	var cart = Object();
	var preserve = '';
	
	var code_basic_cat = '22';
	
	var addcover = false,
		switchcover = false,
		basic_sale = '';
	
	isNotDoubleClick = function () {
				if (typeof (_linkEnabled) == "undefined") _linkEnabled = true;
				setTimeout("blockClick()", 100);
				return _linkEnabled;
	}
	blockClick = function () {
		_linkEnabled = false;
		setTimeout("_linkEnabled=true", 600);
	}
	
	var _item = 0;
			
	var o = !1;
		
	var n = {
		'imagesblank': function(cl){ 
			$('#sc00 .item .'+cl+'').attr('src',o.blank);		
		},		
		'checkshoe': function(){
			var check = false;
			var id = o.color+o.model;	
			var s = o.shoes;
			for(var i=0;i< s.length;i++){ 
				if(id == s[i].code )	check = true;
			}			
			return check;	
		},
		'printshoe' : function(){ 
			n.printcover();
			var id = o.color+o.model;		
			var s = o.shoes
			for(var i=0;i< s.length;i++){
				if(id == s[i].code )	{	
					n.imagesblank('shoe');
					var v = s[i].views; var cont = 0;
					for(var j=0;j< v.length;j++){
						var $item = $('#sc00 .item.view'+j+'');
						$item.find('.shoe').attr('src',v[j]);	
						cont++;
					}
					if( v.length <5){
						for(cont;cont< 6;cont++){
							var $item = $('#sc00 .item.view'+cont+'');
							$item.find('.shoe').attr('src',o.blank);	
						}
					}
					$('.list-items-bag .item').eq(0).find('img.shoes').attr('src',s[i].icon);				
					o.price = s[i].salePrice;
					$('#shoeDesc').text(s[i].description);
				}
			}	
			id = o.sole;
			s = o.soles;
			for(var i=0;i< s.length;i++){
				if(id == s[i].code )	{	
					var v = s[i].views;
					for(var j=0;j< v.length;j++){
						if(v[j].code == o.color+o.model){	
							n.imagesblank('sole');
							var cont = 0;
							for(k=0;k<v[j].pics.length;k++){
								var $item = $('#sc00 .item.view'+k+'');
								$item.find('.sole').attr('src',v[j].pics[k]);		
								cont++;	
							}
							if( v.length <5){
								for(cont;cont< 6;cont++){
									var $item = $('#sc00 .item.view'+cont+'');
									$item.find('.sole').attr('src',o.blank);	
								}
							}
							$('.list-items-bag .item').eq(0).find('img.sole').attr('src',v[j].icon);
						}						
					}
					o.price_sole = s[i].salePrice;
					$('#soleDesc').text(s[i].description);
				}
			}	
			$('aside .desc h3').text('Cod. '+o.color+o.model+o.sole);		
		},	
		'initselect':function(){
			preserve =  $('select[type=sole]').html();
			if(o.color =='BI'){
				$('select[type=sole] option[value=NE]').remove();		
			}else if(o.color =='NE'){
				$('select[type=sole]  option[value=BI]').remove();	
			}			
		},
		'setvalue' : function(t, v){
			$('select[type='+t+']').removeClass('invalid');
			switch(t){
				case 'color':
					o.color = v;			
					$('select[type=sole] ').html( preserve );					
					if(o.color == 'BI'){
						$('select[type=sole] option[value=NE]').remove();		
					}else if(o.color == 'NE'){
						$('select[type=sole]  option[value=BI]').remove();	
					}	
					n.updateallcover();
				break;
				case 'color2':			
					$(' select[type=sole2]  ').html( preserve );
					var val = $(' select[type=color2]  ').val();				
					if(val == 'BI'){						
						$('select[type=sole2]').val('')	;	$('select[type=sole2] option[value=NE]').remove();	
					}else if(val == 'NE'){						
						$('select[type=sole2]').val('')	;	$('select[type=sole2] option[value=BI]').remove();	
					}else{
						$('select[type=sole2]').val('')	;
					}
				break;
				case 'model':
					o.model = v;
					n.updateallcover();
				break;
				case 'sole':
					o.sole = v;
				break;
				case 'size':
					o.size = v;
					$('.size').text('SIZE: '+v);
				break;
			}
			if (t!='size') {
				 if(n.checkshoe()){
					n.printshoe();
					n.updatetotal();
				 }else{
					console.log('Error: shoes not found.')
				 }
			}
		},
		'checkcover': function(cvr){
			var check = false;
			var cvrs = $('.list-items-bag .item.cvr');
			for(var i=0;i< cvrs.length; i++){
				if( cvrs.eq(i).find('a[rel=edit]').attr('data-id')  == cvr ) check = true;
			}
			//if(check===false) tmpcovers.push(cvr);			
			return check;	
		},
		'printcover' : function(){
			var cs = o.covers; 
			for(var i=0;i< cs.length;i++){
				if(o.cover == cs[i].code )	{	
					var v = cs[i].views; 
					for(var j=0;j< v.length;j++){ 
						if(v[j].code == o.color+o.model){	
							n.imagesblank('cover');
							
							var jj = 0;
							var cont = 0;
							for(k=0;k<v[j].pics.length;k++){ 
								var $item = $('#sc00 .item.view'+k+'');
								$item.find('.cover').attr('src',v[j].pics[k]);		
								cont++;	
							}
							if( cont < 6){ 
								for(cont;cont< 6;cont++){
									var $item = $('#sc00 .item.view'+cont+'');
									$item.find('.cover').attr('src',o.blank);	
								}
							}
							var el = $('.list-items-bag .item').eq(_item); 
							el.attr('data-id', cs[i].code );	
							if( code_basic_cat == cs[i].category && (basic_sale == '' || basic_sale == cs[i].code || $('.item.cvr').length==1 )){  
								el.find('.price').text( 'FREE' );
								basic_sale = cs[i].code;
							}else{
								el.find('.price').text( Math.floor(cs[i].salePrice).toFixed(2).replace('.',',') + ' €' );	
							}
							if(o.model =='BA'){
								el.find('.shoes').removeClass('high').addClass('low');
							}else if(o.model =='AL'){
								el.find('.shoes').removeClass('low').addClass('high');
							}		
							
							el.find('.cover').attr('src',v[j].icon);								
							el.find('a').attr('data-id', cs[i].code );	
							el.find('a[rel=edit]').unbind('click').click(function(){ if(!addcover){  
								_item = $('.list-items-bag .item').index( $(this).parent().parent() ); 
								$('.list-items-bag .item').removeClass('bg');
								
								$('.list-items-bag .item').eq(_item).addClass('bg');
								} 
							});
							el.find('a[rel=del]').unbind('click').click(function(){  if(!addcover){  
								var _item_tmp = $(this).parent().parent();
								console.log(_item_tmp.attr('data-id'))
								
								if(_item_tmp.attr('data-id') == basic_sale){ 
									basic_sale = ''; 
								}
								
								_item_tmp.removeClass('bg');
								if(_item_tmp.prev().has('hr')){
									_item_tmp.prev().remove();
								}
								_item_tmp.remove();
								
								
								/*$('.list-items-bag .item').removeClass('bg');
								$('.list-items-bag .item').eq(_item_tmp).prev().remove()
								$('.list-items-bag .item').eq(_item_tmp).remove();*/
								//if(_item == _item_tmp) $('#sc00 .item .cover').attr('src',o.blank);
								//_item = 0;
								if($('.list-items-bag .item').length == 1) { 
									n.imagesblank('cover');
								}else{
									$('.list-items-bag .item.cvr').eq(0).find('a[rel=edit]').trigger('click');
								}
								n.removecover(); 
								n.updatetotal();	
								} 
							});
						}		
								
					}
					
					$('#coverDesc').text(cs[i].description);
				}
			}	
			$('aside .desc h3').text('Cod. '+o.color+o.model+o.sole);					
		},
		'updateallcover' : function(){  
			var cs = o.covers; 
			var cvr =  $('.list-items-bag .item.cvr ');
			for(var i=0;i< cs.length;i++){ 
				for(var k=0;k<cvr.length;k++){ 			
					if(cvr.eq(k).attr('data-id') == cs[i].code){ 
						var v = cs[i].views;
						for(var j=0;j< v.length;j++){ 
							if(v[j].code == o.color+o.model){ 
								var el = cvr.eq(k);
								if(code_basic_cat == cs[i].category && (basic_sale == '' || basic_sale == cs[i].code || cvr.length==1  )){ 
									el.find('.price').text( 'FREE' );
									basic_sale = cs[i].code; 
								}else{
									el.find('.price').text( Math.floor(cs[i].salePrice).toFixed(2).replace('.',',') + ' €' );	
								} 
								
								if(o.model =='BA'){
									el.find('.shoes').removeClass('high').addClass('low');
								}else if(o.model =='AL'){
									el.find('.shoes').removeClass('low').addClass('high');
								}		
								
								el.find('.cover').attr('src',v[j].icon);								
								el.find('a').attr('data-id', cs[i].code );	
								el.find('a[rel=edit]').unbind('click').click(function(){ if(!addcover){  
									_item = $('.list-items-bag .item').index( $(this).parent().parent() ); 
									$('.list-items-bag .item').removeClass('bg');
									
									$('.list-items-bag .item').eq(_item).addClass('bg');
									} 
								});
								el.find('a[rel=del]').unbind('click').click(function(){  if(!addcover){   
									var _item_tmp = $(this).parent().parent();
									
									
									if(_item_tmp.attr('data-id') == basic_sale){
										basic_sale = '';
									}
									_item_tmp.removeClass('bg');
									if(_item_tmp.prev().has('hr')){
										_item_tmp.prev().remove();
									}
									_item_tmp.remove();
									
									
									
									/*$('.list-items-bag .item').removeClass('bg');
									$('.list-items-bag .item').eq(_item_tmp).prev().remove()
									$('.list-items-bag .item').eq(_item_tmp).remove();*/
									//if(_item == _item_tmp) $('#sc00 .item .cover').attr('src',o.blank);
									//_item = 0;
									if($('.list-items-bag .item').length == 1){
										n.imagesblank('cover');
									}else{
										$('.list-items-bag .item.cvr').eq(0).find('a[rel=edit]').trigger('click');
									}
									n.removecover(); 
									n.updatetotal();	
									} 
								});
								
							}	
						}
					}
							
				}
					
			}					
		},	
		
		'setcover' :function(id){
			if(!n.checkcover(id)){
				o.cover = id; 
				n.addcover();
				n.printcover();	
				n.updatetotal();
			}else{	
				console.log('Error: shoes not found.')		
			}
		},
		'addcover' :function(){
			addcover = false;
		},	
		'removecover' :function(){ 			
			n.updateallcover();
		},
		'updatetotal' : function(){
			var total = 0;
			var cvr = $('.list-items-bag .item.cvr');
			if(SECTION!='cover'){
				total += Math.floor(o.price);
				total += Math.floor(o.price_sole);
			}
			for(var i=0;i< cvr.length;i++){				
				if( cvr.eq(i).find('.price').text() == 'FREE'){
				
				}else{
					total += Math.floor(  cvr.eq(i).find('.price').text().replace(',','.').replace('€','') );
				}
			}		
			$('.total').text( total.toFixed(2).replace('.',',') + ' €')			
		},
		'addcart' :function(){			
			var cs = Array();			
		}	
			
	}
	
	listener_index = function(){ 
		var s = 0; 
		var change = true;
		var sld = 0;
		var a = $('#shoes-select .step a');
		var t_color='';
		var t_model='';
		var t_sole='';
		a.each(function(i, el) {
         	$(el).click(function(e){
				var slideTO = Number($(this).attr('slide')); 
				switch($(this).attr('type')){
					case 'color':
						t_color = $(this).attr('data-id');
						if($(this).attr('val') == 'black') {
							sld = 4;
							$('#shoes-select .step a[type=sole]').eq(2).addClass('none');
							$('#shoes-select .step a[type=sole]').eq(1).removeClass('none');
						}else{
							sld = 3;
							$('#shoes-select .step a[type=sole]').eq(1).addClass('none');
							$('#shoes-select .step a[type=sole]').eq(2).removeClass('none');
						}
					break;
					case 'model':
						t_model = $(this).attr('data-id');
					break;
					case 'sole':
						t_sole = $(this).attr('data-id');
					break;
				}
				if(s<2){
					$('#shoes-select .step').eq(s).fadeOut(200, function(){
						s++;
						$('#sc00 .slider-hp .items').trigger('slideTo',slideTO);
						$('#shoes-select .step').eq(s).fadeIn(200);
						if(change) { $('#shoes-select .step').eq(s).find('a').attr('slide',sld); change = false; }
					});
				}else{
					 window.location = '/' + $('html').data('locale') + '/configure/'+t_color+t_model+t_sole
				}
			});		 
        });		
	}
	
	listener_configure = function(){ 
		var s = $('#container select')
       	s.each(function(i, el) {
         	$(el).change(function(e){  
				n.setvalue($(this).attr('type'), $(this).val());				
			});		 
        });			
		var cs = $('#sidebarL .item a')
       	cs.each(function(i, el) { 
         	$(el).click(function(e){ 
				
					//o.cover = $(this).attr('data-id');			
					if(addcover){ 
						if(switchcover) n.setcover($(this).attr('data-id')); 
					}else{
						if( $('.list-items-bag .item').length < 2 ){ 
							$('.add-cover').trigger('click');
						}					
						if(switchcover) n.setcover($(this).attr('data-id')); 
					}
				
			});		 
        });	
		$('.add-cover').click(function(){
			if(!addcover){
				addcover = true; 
				switchcover = true;
				if(o.model =='BA'){
					cl_model = 'low';	
				}else if(o.model =='AL'){
					cl_model = 'high';	
				}else{
                    console.log('o.model: ' + o.model +  ' - cl_model: ' + o.model.slice(2, 2));
                }
				$('.list-items-bag .item').removeClass('bg');
				$('.list-items-bag .item').last().after('<hr> <div class="item clearfix bg cvr" data-id="CS00" > '+
					'<div class="shoes '+cl_model+'"></div>'+
					'<img src="'+o.blank+'" class="cover"> '+
					'<span class="price">0,00</span> '+
					'<span> '+
					'	<a href="#" data-id="CS00" rel="edit" class="none" >Modify</a> '+
					'   <a href="#" data-id="CS00" rel="del" >Delete</a> '+
					'</span>'+
				'</div>');
				_item = $('.list-items-bag .item').index( $('.list-items-bag .item').last() );
			}
		})	
		$('#add-basket').unbind('click').click(function(e){
			e.preventDefault();	
			if(o.size && o.size != 0){			
				var cs = Array();
				for(var i=0;i< $('.list-items-bag .item.cvr').length;i++){	
					cs.push( $('.list-items-bag .item.cvr').eq(i).find('a[rel=edit]').attr('data-id') );
				}
				
				var tot =  Math.floor($('#cart-items').text());
				
				var vars = {
					color : o.color,
					model : o.model,
					sole : o.sole,
					size : o.size,
					covers: cs,
                    section: SECTION
				}
				$.post('/' + $('html').data('locale') + '/add-to-basket', vars, function(data){
					console.log(data)				
					if(data.success){
						$('#cart-items').text(data.products);
						resetbag();
					}else{
						console.log(data.message);
					}
				});
			}else{
                $('#sidebarL .accordion .a01').eq(0).trigger('click');
				$('select[type=size]').addClass('invalid');
				console.log('no size');
			}
		});			
	
		$('.fb-share').unbind('dblclick click').bind('click', function () {
			if (isNotDoubleClick())				
				FB.ui({
					display:'popup',
					method: 'feed',
					name: 'Hide and Jack.',
					link: siteurl+lang+'/configure/'+o.color+o.model+o.sole+'.'+o.cover,
					picture: siteurl+lang+'/img/pic_fb.jpg?1',
					caption: '',
					description: 'Hide and Jack....'
				});
			return false;
		});
		
		$('.tw-share').unbind('dblclick click').bind('click', function () { 
			if (isNotDoubleClick())
				window.open('http://www.twitter.com/share?url='+siteurl+lang+'/configure/'+o.color+o.model+o.sole+'.'+o.cover+'&hashtags=hideandjack&text='+escape('text text #Hide and #Jack.') , 'sharer', 'toolbar=0, status=0, width=626, height=436');
			return false;
		});
	}
	
	resetbag = function(){
		_item = 0;
		addcover = false,
		switchcover = false;
		
		$('#sc00 .item .cover').attr('src',o.blank);		
		var cvr =  $('.list-items-bag .item.cvr');		
		var i= cvr.length - 1 ; 
		var cont = 0;
		
		while( cont < cvr.length ){			
			if( cvr.eq(i).prev().has('hr')){
				cvr.eq(i).prev().remove()
			}
			cvr.eq(i).remove();
			cont++;
			i--;
		}
		
		$('.accordion li').eq(0).find('.a01').trigger('click');
		
		o.color = o.basic.color;
		o.model = o.basic.model;
		o.sole = o.basic.sole;
		o.cover = '';
		o.size = '0';	
		
		tmpcovers = Array();
		
		$('#container select[type=model]').val(o.model).trigger('change');
		$('#container select[type=sole]').val(o.sole).trigger('change');
		$('#container select[type=color]').val(o.color).trigger('change');
		$('#container select[type=size]').val('0').trigger('change');
		$('.size').text('SIZE: - -');
		 
		 if(n.checkshoe()){
			n.printshoe();
			n.updatetotal();
		 }else{
			console.log('Error: shoes not found.');
		 }			
	}
	
	c.hj = function(t){ 
		console.log('init index...')
		listener_index();
		return true;
	}, c.fn.hj = function(t){ 
		console.log('init configure...')
		o = c.extend({
            color : 'NE',
			model : 'AL',
			sole : 'CA',
			size : 0,
			cover : '',
			shoes: [],  
            soles: [],
            covers:  [],
			price : 0,
			price_sole : 0,
			basic : {
				color : 'NE',
                model : 'AL',
                sole : 'CA',
                size : 0
			},
			blank : '/uploads/blank.gif'
        }, t);
		listener_configure();
		n.initselect();	
		if (o.cover != '') { $('#sidebarL .item a[data-id='+o.cover+']').trigger('click'); }
		n.printshoe();	
		n.updatetotal();
	}, c.fn.hjOnlyCover = function(t){ 
		resetbag();		
		o.color = t.color;
		o.model = t.model;
		o.sole = t.sole;
		o.size = t.size;
		$('#container select[type=model]').val(o.model).trigger('change');
		$('#container select[type=sole]').val(o.sole).trigger('change');
		$('#container select[type=color]').val(o.color).trigger('change');
		$('#container select[type=size]').val(o.size).trigger('change');
		n.printshoe();	
		$('.list-items-bag .item.noremove').hide();	
		$('.add-cover').text('+ Add another cover').trigger('click');
		n.updatetotal();	
		
	}, c.fn.hjBasicShoes = function(){ 
		resetbag();		
		n.printshoe();	
		$('.list-items-bag .item.noremove').show();	
		$('.add-cover').text('+ Add cover');
		n.updatetotal();	
	}
})(jQuery);  